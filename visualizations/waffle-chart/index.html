<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráfico de Waffle - ODD Data Viz Generator</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Newsreader:ital,opsz,wght@0,6..72,300;0,6..72,400;0,6..72,500;0,6..72,600;0,6..72,700;1,6..72,300;1,6..72,400;1,6..72,500;1,6..72,600&display=swap" rel="stylesheet">
    
    <!-- CSS Links -->
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/viz.css">
    
    <!-- Chart Styles -->
    <style>
        /* Layout da página de visualização */
        .viz-page {
            display: flex;
            min-height: 100vh;
            background-color: var(--color-bg);
            position: relative;
            overflow: hidden;
        }
        
        /* Container principal da visualização */
        .viz-main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Seção de preview */
        .viz-preview-section {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl);
            background-color: rgba(55, 55, 55, 0.5);
            overflow: hidden;
        }
        
        /* Container do gráfico */
        .chart-container {
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 800px;
            position: relative;
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        /* ✅ Seção de Controles - SEMPRE VISÍVEL E COM SCROLL */
        .viz-controls-section {
            width: 400px;
            height: 100vh;
            background-color: rgba(55, 55, 55, 0.95);
            border-left: 1px solid rgba(250, 249, 250, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
            padding: var(--spacing-xl);
            
            /* ✅ Scroll customizado */
            scrollbar-width: thin;
            scrollbar-color: rgba(108, 218, 222, 0.3) transparent;
        }
        
        .viz-controls-section::-webkit-scrollbar {
            width: 8px;
        }
        
        .viz-controls-section::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .viz-controls-section::-webkit-scrollbar-thumb {
            background: rgba(108, 218, 222, 0.3);
            border-radius: 4px;
        }
        
        .viz-controls-section::-webkit-scrollbar-thumb:hover {
            background: rgba(108, 218, 222, 0.5);
        }
        
        /* Cards de controle - SEMPRE EXPANDIDOS */
        .control-card {
            background: rgba(250, 249, 250, 0.05);
            border: 1px solid rgba(250, 249, 250, 0.15);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-lg);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .control-card:hover {
            border-color: rgba(108, 218, 222, 0.3);
            box-shadow: 0 8px 32px rgba(108, 218, 222, 0.15);
        }
        
        .control-card-header {
            padding: var(--spacing-lg);
            background: linear-gradient(145deg, rgba(250, 249, 250, 0.02) 0%, rgba(108, 218, 222, 0.02) 100%);
            border-bottom: 1px solid rgba(250, 249, 250, 0.1);
        }
        
        .control-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--color-text);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-style: normal; /* ✅ FORÇA FONTE NORMAL PARA OS TÍTULOS */
        }
        
        /* ✅ CONTENT SEMPRE VISÍVEL */
        .control-card-content {
            padding: var(--spacing-lg);
            display: block !important; /* Força display sempre visível */
            opacity: 1 !important;
            max-height: none !important;
            overflow: visible !important;
        }
        
        /* Cards especiais */
        .data-card {
            border-color: rgba(108, 218, 222, 0.3);
        }
        
        .data-card .control-card-header {
            background: linear-gradient(145deg, rgba(108, 218, 222, 0.1) 0%, rgba(108, 218, 222, 0.05) 100%);
        }
        
        .export-card {
            border-color: rgba(111, 2, 253, 0.3);
        }
        
        .export-card .control-card-header {
            background: linear-gradient(145deg, rgba(111, 2, 253, 0.1) 0%, rgba(111, 2, 253, 0.05) 100%);
        }
        
        .appearance-card {
            border-color: rgba(237, 255, 25, 0.3);
        }
        
        .appearance-card .control-card-header {
            background: linear-gradient(145deg, rgba(237, 255, 25, 0.1) 0%, rgba(237, 255, 25, 0.05) 100%);
        }
        
        /* Textarea para dados */
        .control-textarea {
            width: 100%;
            padding: var(--spacing-sm);
            background-color: rgba(250, 249, 250, 0.05);
            border: 1px solid rgba(250, 249, 250, 0.2);
            border-radius: var(--radius-md);
            color: var(--color-text);
            font-size: 0.875rem;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
        }
        
        .control-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            background-color: rgba(250, 249, 250, 0.08);
        }
        
        /* Prévia dos dados */
        .data-preview {
            background-color: rgba(250, 249, 250, 0.03);
            border: 1px solid rgba(250, 249, 250, 0.1);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .data-placeholder {
            color: rgba(250, 249, 250, 0.5);
            font-style: italic;
            text-align: center;
            padding: var(--spacing-lg);
        }
        
        /* Estilos para controles de range com valor */
        .range-with-value {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .control-range {
            flex: 1;
        }
        
        .range-value {
            min-width: 60px;
            text-align: right;
            font-size: 0.875rem;
            color: var(--color-accent);
            font-weight: 500;
        }
        
        /* Breadcrumb */
        .viz-breadcrumb {
            padding: var(--spacing-lg) var(--spacing-xl);
            background-color: rgba(55, 55, 55, 0.8);
            border-bottom: 1px solid rgba(250, 249, 250, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-size: 0.875rem;
        }
        
        .breadcrumb a {
            color: var(--color-text);
            text-decoration: none;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        .breadcrumb a:hover {
            opacity: 1;
        }
        
        .breadcrumb-separator {
            color: rgba(250, 249, 250, 0.3);
        }
        
        .breadcrumb-current {
            color: var(--color-accent);
            font-weight: 500;
        }
        
        /* Responsividade */
        @media (max-width: 1200px) {
            .viz-controls-section {
                width: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .viz-page {
                flex-direction: column;
            }
            
            .viz-controls-section {
                width: 100%;
                height: auto;
                border-left: none;
                border-top: 1px solid rgba(250, 249, 250, 0.1);
                max-height: 50vh;
            }
            
            .viz-preview-section {
                min-height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="viz-page">
        <!-- Container Principal -->
        <div class="viz-main-container">
            <!-- Breadcrumb -->
            <nav class="viz-breadcrumb">
                <div class="breadcrumb">
                    <a href="../../index.html">Home</a>
                    <span class="breadcrumb-separator">›</span>
                    <span class="breadcrumb-current">Gráfico de Waffle</span>
                </div>
            </nav>
            
            <!-- Área de Preview -->
            <div class="viz-preview-section">
                <div class="chart-container" id="chart-container">
                    <div id="chart">
                        <p class="chart-placeholder">Carregando visualização...</p>
                    </div>
                </div>
                
                <!-- Botões flutuantes de ação -->
                <div class="viz-actions">
                    <button class="action-button" id="export-svg" title="Exportar SVG">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                        </svg>
                    </button>
                    <button class="action-button" id="export-png" title="Exportar PNG">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                    </button>
                    <button class="action-button" id="copy-embed" title="Copiar código embed">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="16 18 22 12 16 6"/>
                            <polyline points="8 6 2 12 8 18"/>
                        </svg>
                    </button>
                    <button class="action-button" id="fullscreen" title="Tela cheia">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                    </button>
                    
                    <!-- Info Tooltip -->
                    <aside class="viz-info-tooltip">
                        <div class="info-tooltip-trigger">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="10" cy="10" r="9"/>
                                <line x1="10" y1="15" x2="10" y2="9"/>
                                <circle cx="10" cy="6" r="1" fill="currentColor"/>
                            </svg>
                        </div>
                        <div class="info-tooltip-content">
                            <h4>Gráfico de Waffle</h4>
                            <p>Visualização ideal para mostrar proporções e distribuições em formato de grade 10x10.</p>
                            <ul>
                                <li>Cada quadrado representa 1% do total</li>
                                <li>Máximo de 10 categorias</li>
                                <li>Cores aplicadas por categoria</li>
                                <li>Interativo com hover</li>
                            </ul>
                        </div>
                    </aside>
                </div>
            </div>
        </div>

        <!-- Seção de Controles - Cards em Grid -->
        <div class="viz-controls-section">
            
            <!-- Card de Dados -->
            <div class="control-card data-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">📊 Dados</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label for="data-text-input" class="control-label">Dados CSV</label>
                        <textarea id="data-text-input" class="control-textarea" rows="8" placeholder="Cole seus dados CSV aqui...">categoria,valor
Categoria A,35
Categoria B,25
Categoria C,20
Categoria D,15
Categoria E,5</textarea>
                        <p class="control-help">
                            Cole dados CSV ou <button type="button" class="link-button" id="load-sample">restaurar exemplo</button>
                        </p>
                    </div>

                    <div class="control-group">
                        <label for="data-input" class="control-label">Ou fazer Upload de Arquivo</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="data-input" accept=".csv,.json" class="file-input">
                            <label for="data-input" class="file-input-label">
                                Escolher arquivo CSV/JSON
                            </label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="data-preview" class="control-label">Prévia dos Dados</label>
                        <div id="data-preview" class="data-preview">
                            <p class="data-placeholder">Carregando dados...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Configurações Gerais -->
            <div class="control-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">⚙️ Configurações Gerais</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label for="chart-title" class="control-label">Título</label>
                        <input type="text" id="chart-title" class="control-input" value="Distribuição por Categoria">
                    </div>

                    <div class="control-group">
                        <label for="chart-subtitle" class="control-label">Subtítulo</label>
                        <input type="text" id="chart-subtitle" class="control-input" value="Visualização em formato waffle">
                    </div>

                    <div class="control-group">
                        <label for="data-source" class="control-label">Fonte dos Dados</label>
                        <input type="text" id="data-source" class="control-input" placeholder="Ex: IBGE, 2024">
                    </div>

                    <div class="control-group">
                        <label class="control-label">Formato de Tela</label>
                        <div class="radio-group">
                            <label class="radio-wrapper">
                                <input type="radio" name="screen-format" value="desktop">
                                <span class="radio-button"></span>
                                <span class="radio-label">Desktop (16:9)</span>
                            </label>
                            <label class="radio-wrapper">
                                <input type="radio" name="screen-format" value="square" checked>
                                <span class="radio-button"></span>
                                <span class="radio-label">Quadrado (1:1)</span>
                            </label>
                            <label class="radio-wrapper">
                                <input type="radio" name="screen-format" value="mobile">
                                <span class="radio-button"></span>
                                <span class="radio-label">Mobile (9:16)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Configurações do Waffle -->
            <div class="control-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">🧇 Configurações do Waffle</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label for="waffle-size" class="control-label">Tamanho dos Quadrados</label>
                        <div class="range-with-value">
                            <input type="range" id="waffle-size" class="control-range" 
                                   min="12" max="35" value="25" step="1">
                            <span class="range-value" id="waffle-size-value">25px</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="waffle-gap" class="control-label">Espaçamento entre Quadrados</label>
                        <div class="range-with-value">
                            <input type="range" id="waffle-gap" class="control-range" 
                                   min="0.5" max="6" value="2" step="0.5">
                            <span class="range-value" id="waffle-gap-value">2px</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="waffle-roundness" class="control-label">Arredondamento dos Cantos</label>
                        <div class="range-with-value">
                            <input type="range" id="waffle-roundness" class="control-range" 
                                   min="0" max="25" value="3" step="0.5">
                            <span class="range-value" id="waffle-roundness-value">3px</span>
                        </div>
                        <p class="control-help">Arraste até o final para criar círculos perfeitos</p>
                    </div>

                    <div class="control-group">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="waffle-animation">
                            <span class="checkmark"></span>
                            <span class="checkbox-label">Animação de Entrada</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="waffle-hover-effect" checked>
                            <span class="checkmark"></span>
                            <span class="checkbox-label">Efeito de Hover</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Card de Cores -->
            <div class="control-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">🎨 Cores</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label class="control-label">Paleta de Cores</label>
                        <div class="radio-group">
                            <label class="radio-wrapper">
                                <input type="radio" name="color-palette" value="odd" checked>
                                <span class="radio-button"></span>
                                <span class="radio-label">ODD Studio</span>
                            </label>
                            <label class="radio-wrapper">
                                <input type="radio" name="color-palette" value="custom">
                                <span class="radio-button"></span>
                                <span class="radio-label">Personalizada</span>
                            </label>
                        </div>
                    </div>

                    <div id="custom-colors" class="control-group" style="display: none;">
                        <label class="control-label">Cores Personalizadas</label>
                        <div class="color-inputs-grid" id="custom-color-inputs">
                            <!-- Cores serão adicionadas dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Tipografia -->
            <div class="control-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">🔤 Tipografia</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label for="font-family" class="control-label">Família de Fonte</label>
                        <select id="font-family" class="control-select">
                            <option value="Inter">Inter</option>
                            <option value="Newsreader">Newsreader</option>
                            <option value="Arial">Arial</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Courier New">Courier New</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label for="title-size" class="control-label">Tamanho do Título</label>
                        <div class="range-with-value">
                            <input type="range" id="title-size" class="control-range" 
                                   min="16" max="48" value="24" step="1">
                            <span class="range-value" id="title-size-value">24px</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="subtitle-size" class="control-label">Tamanho do Subtítulo</label>
                        <div class="range-with-value">
                            <input type="range" id="subtitle-size" class="control-range" 
                                   min="12" max="32" value="16" step="1">
                            <span class="range-value" id="subtitle-size-value">16px</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Aparência -->
            <div class="control-card appearance-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">✨ Aparência</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label class="control-label">Cor de Fundo</label>
                        <div class="color-input-group">
                            <input type="color" id="bg-color" class="color-picker" value="#FFFFFF">
                            <input type="text" id="bg-color-text" class="color-text" value="#FFFFFF">
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Cor do Texto</label>
                        <div class="color-input-group">
                            <input type="color" id="text-color" class="color-picker" value="#2C3E50">
                            <input type="text" id="text-color-text" class="color-text" value="#2C3E50">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Rótulos -->
            <div class="control-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">🏷️ Rótulos</h3>
                </div>
                <div class="control-card-content">
                    <div class="control-group">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="show-legend" checked>
                            <span class="checkmark"></span>
                            <span class="checkbox-label">Mostrar Rótulos Diretos</span>
                        </label>
                    </div>

                    <div class="control-group" id="direct-label-controls">
                        <label class="control-label">Posição dos Rótulos</label>
                        <div class="radio-group">
                            <label class="radio-wrapper">
                                <input type="radio" name="direct-label-position" value="right" checked>
                                <span class="radio-button"></span>
                                <span class="radio-label">Direita</span>
                            </label>
                            <label class="radio-wrapper">
                                <input type="radio" name="direct-label-position" value="left">
                                <span class="radio-button"></span>
                                <span class="radio-label">Esquerda</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Exportação -->
            <div class="control-card export-card">
                <div class="control-card-header">
                    <h3 class="control-card-title">💾 Exportação</h3>
                </div>
                <div class="control-card-content">
                    <div class="export-buttons">
                        <button class="button button-secondary" id="export-svg-btn">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            Exportar SVG
                        </button>
                        <button class="button button-secondary" id="export-png-btn">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            Exportar PNG
                        </button>
                        <button class="button button-primary" id="copy-embed-btn">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="16 18 22 12 16 6"/>
                                <polyline points="8 6 2 12 8 18"/>
                            </svg>
                            Copiar Embed Code
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../../js/data-utils.js"></script>
    <script src="../../js/export-utils.js"></script>
    <script src="config.js"></script>
    <script src="viz.js"></script>
</body>
</html>
